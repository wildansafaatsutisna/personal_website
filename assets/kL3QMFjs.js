import{u as B}from"./D_gjbH0-.js";import"./C4E6UyWt.js";import{o as ne,g as $e,p as De,s as Te,q as Ee,v as ue,m as _e,w as ie}from"./2m5216oT.js";import{c as Ae,a as x}from"./D24KpswP.js";import{_ as Ve}from"./GviIUq2w.js";import{_ as Fe}from"./CsGL2TZN.js";import{r as J,l as He,E as Me,v as w,n as P,a2 as V,M as Re,H as Le,w as Ne,a9 as je,aa as ze,o as i,a as g,c as d,I as C,A as S,d as U,t as F,z as H,q as h,j as q,L as K,F as T,b as Oe}from"./p68tr7qn.js";const Ue=["TD","TH","TR"],qe=["a","a *","button","button *","input:not(.disabled):not([disabled])","select:not(.disabled):not([disabled])","textarea:not(.disabled):not([disabled])",'[role="link"]','[role="link"] *','[role="button"]','[role="button"] *',"[tabindex]:not(.disabled):not([disabled])"].join(","),W=M=>{if(!M||!M.target)return!1;const y=M.target;if("disabled"in y&&y.disabled||Ue.indexOf(y.tagName)!==-1)return!1;if(ne(".dropdown-menu",y))return!0;const R=y.tagName==="LABEL"?y:ne("label",y);if(R){const a=$e(R,"for"),c=a?De(a):Te("input, select, textarea",R);if(c&&!c.disabled)return!0}return Ee(y,qe)},Ke=()=>{const M=(b,l)=>{const o=[];return!(b!=null&&b.length)&&(l!=null&&l.length)?(Object.keys(l[0]).forEach(v=>o.push({key:v,label:ue(v)})),o):(Array.isArray(b)&&b.forEach(v=>{typeof v=="string"?o.push({key:v,label:ue(v)}):_e(v)&&v.key&&typeof v.key=="string"&&o.push({...v})}),o)},y=J([]),R=(b,l,o,v)=>(y.value=Ae(l),"isFilterableTable"in v&&v.isFilterableTable.value===!0&&o.filter&&(y.value=G(y.value,o.filter,o.filterable)),"isSortable"in v&&v.isSortable.value===!0&&(y.value=c(b,y.value,{key:o.sortBy,desc:v.sortDescBoolean.value},o.sortCompare)),y.value),a=J(void 0),c=(b,l,o,v)=>{if(!o||!o.key)return l;const k=o.key;return l.sort((_,m)=>{if(v!==void 0)return v(_,m,o.key,o.desc);const L=r=>typeof r=="object"?JSON.stringify(r):r;return L(_[k])>L(m[k])?o.desc?-1:1:L(m[k])>L(_[k])?o.desc?1:-1:0})},G=(b,l,o)=>b.filter(v=>Object.entries(v).filter(k=>{const[_,m]=k;return!m||_[0]==="_"||o.length>0&&!o.includes(_)?!1:(typeof m=="object"?JSON.stringify(Object.values(m)):typeof m=="string"?m:m.toString()).toLowerCase().includes(l.toLowerCase())}).length>0);return{normaliseFields:M,mapItems:R,internalItems:y,updateInternalItems:async b=>{try{return y.value=await x(b),y.value}catch{return}},filterEvent:a,notifyFilteredItems:()=>{a.value&&a.value(y.value)},formatItem:(b,l)=>{const o=b[l.key];return l.formatter&&typeof l.formatter=="function"?l.formatter(o,l.key,b):b[l.key]}}},We=["title","abbr","onClick"],Je={class:"d-inline-flex flex-nowrap align-items-center gap-1"},Ge={key:1},Qe=["onClick","onDblclick","onMouseenter","onMouseleave"],Xe={key:0,class:"b-table-stacked-label"},Ye=["colspan"],Ze=["colspan"],xe={class:"d-flex align-items-center justify-content-center gap-2"},et={key:1,class:"b-table-empty-slot"},tt=["colspan"],at={key:0},st=["title","abbr","onClick"],lt={key:1},ot={key:2},rt={key:3},bt=He({__name:"BTable",props:{align:{},caption:{},captionTop:{type:[String,Boolean],default:!1},borderless:{type:[String,Boolean],default:!1},bordered:{type:[String,Boolean],default:!1},borderVariant:{},dark:{type:[String,Boolean],default:!1},fields:{default:()=>[]},footClone:{type:[String,Boolean],default:!1},hover:{type:[String,Boolean],default:!1},items:{default:()=>[]},provider:{},sortCompare:{},noProvider:{},noProviderPaging:{type:[String,Boolean]},noProviderSorting:{type:[String,Boolean]},noProviderFiltering:{type:[String,Boolean]},responsive:{type:[Boolean,String],default:!1},small:{type:[String,Boolean],default:!1},striped:{type:[String,Boolean],default:!1},stacked:{type:[Boolean,String],default:!1},labelStacked:{type:Boolean,default:!1},variant:{},sortBy:{},sortDesc:{type:[String,Boolean],default:!1},sortInternal:{type:[String,Boolean],default:!0},selectable:{type:[String,Boolean],default:!1},stickySelect:{type:[String,Boolean],default:!1},selectHead:{type:[Boolean,String],default:!0},selectMode:{default:"single"},selectionVariant:{default:"primary"},stickyHeader:{type:[String,Boolean],default:!1},busy:{type:[String,Boolean],default:!1},showEmpty:{type:[String,Boolean],default:!1},perPage:{},currentPage:{default:1},filter:{},filterable:{},emptyText:{default:"There are no records to show"},emptyFilteredText:{default:"There are no records matching your request"}},emits:["headClicked","rowClicked","rowDblClicked","rowHovered","rowUnhovered","rowSelected","rowUnselected","selection","update:busy","update:sortBy","update:sortDesc","sorted","filtered"],setup(M,{expose:y,emit:R}){const a=M,c=R,G=Me(),I=Ke(),ee=B(w(a,"footClone")),E=B(w(a,"sortDesc")),b=B(w(a,"sortInternal")),l=B(w(a,"selectable")),o=B(w(a,"stickySelect")),v=B(w(a,"labelStacked")),k=B(w(a,"busy")),_=B(w(a,"showEmpty")),m=B(w(a,"noProviderPaging")),L=B(w(a,"noProviderSorting")),te=B(w(a,"noProviderFiltering")),f=J(k.value);I.filterEvent.value=async e=>{if(j.value){await Y();return}const s=await x(e);c("filtered",s)};const r=J(new Set([])),ce=P(()=>r.value.size>0),de=P(()=>({[`align-${a.align}`]:a.align!==void 0,"b-table-selectable":l.value,[`b-table-select-${a.selectMode}`]:l.value,"b-table-selecting user-select-none":l.value&&ce.value,"b-table-busy":f.value,"b-table-sortable":$.value,"b-table-sort-desc":$.value&&E.value===!0,"b-table-sort-asc":$.value&&E.value===!1})),ve=P(()=>({bordered:a.bordered,borderless:a.borderless,borderVariant:a.borderVariant,captionTop:a.captionTop,dark:a.dark,hover:a.hover,responsive:a.responsive,striped:a.striped,stacked:a.stacked,small:a.small,tableClass:de.value,tableVariant:a.variant,stickyHeader:a.stickyHeader})),A=P(()=>I.normaliseFields(a.fields,a.items)),Q=P(()=>A.value.length+(l.value?1:0)),X=P(()=>a.filter!==void 0&&a.filter!==""),j=P(()=>a.provider!==void 0),ae=P(()=>l.value&&(!!a.selectHead||G.selectHead!==void 0)),$=P(()=>a.fields.filter(e=>typeof e=="string"?!1:e.sortable).length>0),ye=P(()=>$.value&&b.value===!0),D=P(()=>{const e=j.value?I.internalItems.value:ye.value?I.mapItems(a.fields,a.items,a,{isSortable:$,isFilterableTable:X,sortDescBoolean:E}):a.items;if(a.perPage!==void 0){const s=(a.currentPage-1)*a.perPage;return e.splice(s,a.perPage)}return e}),se=e=>typeof e=="string"?ie(e):e.label!==void 0?e.label:typeof e.key=="string"?ie(e.key):e.key,le=(e,s,n=!1)=>{const t=typeof e=="string"?e:e.key;c("headClicked",t,e,s,n),he(e)},be=(e,s,n)=>{c("rowClicked",e,s,n),ke(e,s,n.shiftKey)},pe=(e,s,n)=>c("rowDblClicked",e,s,n),fe=(e,s,n)=>c("rowHovered",e,s,n),ge=(e,s,n)=>c("rowUnhovered",e,s,n),he=e=>{if(!$.value)return;const s=typeof e=="string"?e:e.key,n=typeof e=="string"?!1:e.sortable;if($.value===!0&&n===!0){const t=!E.value;s!==a.sortBy&&c("update:sortBy",s),c("update:sortDesc",t),c("sorted",s,t)}},z=()=>{l.value&&c("selection",Array.from(r.value))},ke=(e,s,n=!1)=>{if(l.value){if(r.value.has(e))r.value.delete(e),c("rowUnselected",e);else if(a.selectMode==="single"&&r.value.size>0&&(r.value.forEach(t=>c("rowUnselected",t)),r.value.clear()),a.selectMode==="range"&&r.value.size>0&&n){const t=Array.from(r.value).pop(),p=D.value.findIndex(N=>N===t),u=Math.min(p,s),Z=Math.max(p,s);D.value.slice(u,Z+1).forEach(N=>{r.value.has(N)||(r.value.add(N),c("rowSelected",N))})}else r.value.add(e),c("rowSelected",e);z()}},Y=async()=>{if(!j.value||!a.provider||f.value)return;f.value=!0;const e=new Proxy({currentPage:a.currentPage,filter:a.filter,sortBy:a.sortBy,sortDesc:a.sortDesc,perPage:a.perPage},{get(n,t){return t in n?n[t]:void 0},set(){return console.error("BTable provider context is a read-only object."),!0}}),s=a.provider(e,I.updateInternalItems);if(s!==void 0){if(s instanceof Promise)try{const n=await s;return Array.isArray(n)?await I.updateInternalItems(n):void 0}finally{f.value&&(f.value=!1)}try{return await I.updateInternalItems(s)}finally{f.value&&(f.value=!1)}}},oe=e=>{e._showDetails=!e._showDetails},me=e=>[e.class,e.thClass,e.variant?`table-${e.variant}`:void 0,{"b-table-sortable-column":$.value&&e.sortable,"b-table-sticky-column":e.stickyColumn}],Se=(e,s)=>[e.class,e.tdClass,e.variant?`table-${e.variant}`:void 0,s!=null&&s._cellVariants&&(s!=null&&s._cellVariants[e.key])?`table-${s==null?void 0:s._cellVariants[e.key]}`:void 0,{"b-table-sticky-column":e.stickyColumn}],re=e=>[e._rowVariant?`table-${e._rowVariant}`:null,e._rowVariant?`table-${e._rowVariant}`:null,l.value&&r.value.has(e)?`selected table-${a.selectionVariant}`:null],Be=()=>{if(!l.value)return;const e=r.value.size>0?Array.from(r.value):[];r.value=new Set([...D.value]),r.value.forEach(s=>{e.includes(s)||c("rowSelected",s)}),z()},we=()=>{l.value&&(r.value.forEach(e=>{c("rowUnselected",e)}),r.value=new Set([]),z())},Pe=e=>{if(!l.value)return;const s=D.value[e];!s||r.value.has(s)||(r.value.add(s),c("rowSelected",s),z())},Ce=e=>{if(!l.value)return;const s=D.value[e];!s||!r.value.has(s)||(r.value.delete(s),c("rowUnselected",s),z())},O=async(e,s,n)=>{if(s===n)return;const t=Ie=>a.noProvider&&a.noProvider.includes(Ie),p=!["currentPage","perPage"].includes(e),u=["currentPage","perPage"].includes(e)&&(t("paging")||m.value===!0),Z=["filter"].includes(e)&&(t("filtering")||te.value===!0),N=["sortBy","sortDesc"].includes(e)&&(t("sorting")||L.value===!0);u||Z||N||(await Y(),p&&I.notifyFilteredItems())};return V(()=>a.filter,(e,s)=>{e===s||j.value||e||x(a.items).then(n=>c("filtered",n))}),V(()=>f.value,()=>f.value!==k.value&&c("update:busy",f.value)),V(()=>k.value,()=>f.value!==k.value&&(f.value=k.value)),V(()=>a.filter,(e,s)=>O("filter",e,s)),V(()=>a.currentPage,(e,s)=>O("currentPage",e,s)),V(()=>a.perPage,(e,s)=>O("perPage",e,s)),V(()=>a.sortBy,(e,s)=>O("sortBy",e,s)),V(()=>a.sortDesc,(e,s)=>O("sortDesc",e,s)),Re(()=>{j.value&&Y()}),y({selectAllRows:Be,clearSelected:we,selectRow:Pe,unselectRow:Ce}),(e,s)=>(i(),Le(Fe,je(ze(ve.value)),{default:Ne(()=>{var n;return[g("thead",null,[e.$slots["thead-top"]?S(e.$slots,"thead-top",{key:0}):C("",!0),g("tr",null,[ae.value?(i(),d("th",{key:0,class:H(["b-table-selection-column",{"b-table-sticky-column":h(o)}])},[S(e.$slots,"select-head",{},()=>[U(F(typeof e.selectHead=="boolean"?"Selected":e.selectHead),1)])],2)):C("",!0),(i(!0),d(T,null,q(A.value,t=>(i(),d("th",K({key:t.key,scope:"col",class:me(t),title:t.headerTitle,abbr:t.headerAbbr,style:t.thStyle},{ref_for:!0},t.thAttr,{onClick:p=>le(t,p)}),[g("div",Je,[S(e.$slots,"sort-icon",{field:t,sortBy:e.sortBy,selected:t.key===e.sortBy,isDesc:h(E),direction:h(E)?"desc":"asc"},()=>[$.value&&t.sortable?(i(),d("span",{key:0,class:H(["b-table-sort-icon",{sorted:t.key===e.sortBy,[`sorted-${h(E)?"desc":"asc"}`]:t.key===e.sortBy}])},null,2)):C("",!0)]),g("div",null,[e.$slots["head("+t.key+")"]||e.$slots["head()"]?S(e.$slots,e.$slots["head("+t.key+")"]?"head("+t.key+")":"head()",{key:0,label:t.label}):(i(),d(T,{key:1},[U(F(se(t)),1)],64))])])],16,We))),128))]),e.$slots["thead-sub"]?(i(),d("tr",Ge,[(i(!0),d(T,null,q(A.value,t=>(i(),d("td",{key:t.key,scope:"col",class:H([t.class,t.thClass,t.variant?`table-${t.variant}`:""])},[e.$slots["thead-sub"]?S(e.$slots,"thead-sub",K({key:0,items:A.value},{ref_for:!0},t)):(i(),d(T,{key:1},[U(F(t.label),1)],64))],2))),128))])):C("",!0)]),g("tbody",null,[(i(!0),d(T,null,q(D.value,(t,p)=>(i(),d(T,{key:p},[g("tr",{class:H(re(t)),onClick:u=>!h(W)(u)&&be(t,p,u),onDblclick:u=>!h(W)(u)&&pe(t,p,u),onMouseenter:u=>!h(W)(u)&&fe(t,p,u),onMouseleave:u=>!h(W)(u)&&ge(t,p,u)},[ae.value?(i(),d("td",{key:0,class:H(["b-table-selection-column",{"b-table-sticky-column":h(o)}])},[S(e.$slots,"select-cell",{},()=>[g("span",{class:H(r.value.has(t)?"text-primary":"")},"🗹",2)])],2)):C("",!0),(i(!0),d(T,null,q(A.value,u=>(i(),d("td",K({key:u.key},{ref_for:!0},u.tdAttr,{class:Se(u,t)}),[e.stacked&&h(v)?(i(),d("label",Xe,F(se(u)),1)):C("",!0),e.$slots["cell("+u.key+")"]||e.$slots["cell()"]?S(e.$slots,e.$slots["cell("+u.key+")"]?"cell("+u.key+")":"cell()",{key:1,value:t[u.key],index:p,item:t,field:u,items:e.items,toggleDetails:()=>oe(t),detailsShowing:t._showDetails}):(i(),d(T,{key:2},[U(F(h(I).formatItem(t,u)),1)],64))],16))),128))],42,Qe),t._showDetails===!0&&e.$slots["row-details"]?(i(),d("tr",{key:0,class:H(re(t))},[g("td",{colspan:Q.value},[S(e.$slots,"row-details",{item:t,toggleDetails:()=>oe(t)})],8,Ye)],2)):C("",!0)],64))),128)),f.value?(i(),d("tr",{key:0,class:H(["b-table-busy-slot",{"b-table-static-busy":D.value.length==0}])},[g("td",{colspan:Q.value},[S(e.$slots,"table-busy",{},()=>[g("div",xe,[Oe(Ve,{class:"align-middle"}),s[0]||(s[0]=g("strong",null,"Loading...",-1))])])],8,Ze)],2)):C("",!0),h(_)&&D.value.length===0?(i(),d("tr",et,[g("td",{colspan:Q.value},[S(e.$slots,"empty",{items:D.value,filtered:X.value},()=>[U(F(X.value?e.emptyFilteredText:e.emptyText),1)])],8,tt)])):C("",!0)]),h(ee)?(i(),d("tfoot",at,[g("tr",null,[(i(!0),d(T,null,q(A.value,t=>(i(),d("th",K({key:t.key},{ref_for:!0},t.thAttr,{scope:"col",class:[t.class,t.thClass,t.variant?`table-${t.variant}`:""],title:t.headerTitle,abbr:t.headerAbbr,style:t.thStyle,onClick:p=>le(t,p,!0)}),F(t.label),17,st))),128))])])):e.$slots["custom-foot"]?(i(),d("tfoot",lt,[S(e.$slots,"custom-foot",{fields:A.value,items:e.items,columns:(n=A.value)==null?void 0:n.length})])):C("",!0),e.$slots["table-caption"]?(i(),d("caption",ot,[S(e.$slots,"table-caption")])):e.caption?(i(),d("caption",rt,F(e.caption),1)):C("",!0)]}),_:3},16))}});export{bt as default};
